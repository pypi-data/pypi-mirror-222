#!/usr/bin/env python3
import argparse
import os
from iseqresources.docker_versions import DockerVersions

__version__ = "0.0.1"

GITLAB_TOKEN=os.environ.get("GITLAB_TOKEN")


def args_parser_init() -> argparse.Namespace:
    """Get user inputs"""
    parser = argparse.ArgumentParser(
        description="""Update docker-versions.json based on tools.json
Get more info at:
    https://gitlab.com/intelliseq/iseqresources""",
    )
    parser.add_argument(
        "-d",
        "--docker-versions-json",
        type=str,
        default="src/main/resources/docker-versions.json",
        help="""The path to the docker-versions.json that we want to generate or update (containing info about the tools' versions in .json format).
For example
{
    "PHARMCAT_VER": "2.3.0",
    "FASTQC_VER": "0.12.1"
}""",
    )
    parser.add_argument(
        "-t",
        "--tools-json",
        type=str,
        default="https://gitlab.com/intelliseq/iseqresources/-/raw/main/json/tools.json",
        help="""The path or link to the tools.json file (generated by iseqresources).
For example (one element of .json array):
{
    "name": "multiqc",
    "current_version": "v1.14",
    "newest_version": "",
    "last_check": "2023/01/26",
    "test": "github",
    "repoWithOwner": "ewels/MultiQC",
    "update_task": [
        "qc_multiqc",
        "rna_seq_multiqc"
    ]
}""",
    )
    parser.add_argument(
        "-v", "--version", action="version", version="%(prog)s {}".format(__version__)
    )

    args = parser.parse_args()
    return args


def main() -> None:
    """All steps to update docker-versions.json"""
    args = args_parser_init()

    docker_versions = DockerVersions(args.docker_versions_json, args.tools_json, GITLAB_TOKEN)
    docker_versions.update_docker_versions()
    

if __name__ == "__main__":
    main()