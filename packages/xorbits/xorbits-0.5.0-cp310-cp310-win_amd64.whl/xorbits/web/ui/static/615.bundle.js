"use strict";(self.webpackChunkxorbits_ui=self.webpackChunkxorbits_ui||[]).push([[615],{2615:(t,e,o)=>{o.r(e),o.d(e,{default:()=>S});var n=o(3838),r=o(5697),s=o.n(r),i=o(7294),a=o(9058),c=o.n(a),u=o(9142),l=o.n(u),d=o(816);function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function f(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function y(t,e){if(e&&("object"===p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(u,t);var e,o,r,s,a=(r=u,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=b(r);if(s){var o=b(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return y(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=a.call(this,t)).state={nodeStatusMap:[{text:"Pending",color:"rgb(255, 255, 255)"},{text:"Running",color:"rgb(240, 180, 0)"},{text:"Succeeded",color:"rgb(0, 205, 149)"},{text:"Failed",color:"rgb(231,76,60)"},{text:"Cancelled",color:"rgb(191,201,202)"}],inputNodeColor:"rgb(50,129,168)",outputNodeColor:"rgb(195,52,235)",subtaskWidth:60,subtaskHeight:60},e}return e=u,(o=[{key:"getProgressSVG",value:function(t,e,o,n,r){if("Input"===t){var s="\n        <svg width='".concat(n,"' height='").concat(r,"' viewBox='0 0 ").concat(n," ").concat(r,"' version='1.1' xmlns='http://www.w3.org/2000/svg'>\n          <rect x='0' y='0' width='").concat(n,"' height='").concat(r,"' style='fill:").concat(this.state.inputNodeColor,";stroke-width:0.3;stroke:rgb(0,0,0)' />\n          <rect x='").concat(n,"' y='0' width='0' height='").concat(r,"' style='fill:rgb(255, 255, 255);stroke-width:0.1;stroke:rgb(0, 0, 0)' />\n        </svg>");return encodeURI("data:image/svg+xml;utf-8,"+s)}if("Output"===t){var i="\n        <svg width='".concat(n,"' height='").concat(r,"' viewBox='0 0 ").concat(n," ").concat(r,"' version='1.1' xmlns='http://www.w3.org/2000/svg'>\n          <rect x='0' y='0' width='").concat(n,"' height='").concat(r,"' style='fill:").concat(this.state.outputNodeColor,";stroke-width:0.3;stroke:rgb(0,0,0)' />\n          <rect x='").concat(n,"' y='0' width='0' height='").concat(r,"' style='fill:rgb(255, 255, 255);stroke-width:0.1;stroke:rgb(0, 0, 0)' />\n        </svg>");return encodeURI("data:image/svg+xml;utf-8,"+i)}var a=n*e,c=n-a,u="\n      <svg width='".concat(n,"' height='").concat(r,"' viewBox='0 0 ").concat(n," ").concat(r,"' version='1.1' xmlns='http://www.w3.org/2000/svg'>\n        <rect x='0' y='0' width='").concat(n,"' height='").concat(r,"' style='fill:").concat(this.state.nodeStatusMap[o].color,";stroke-width:0.3;stroke:rgb(0,0,0)' />\n        <rect x='").concat(a,"' y='0' width='").concat(c,"' height='").concat(r,"' style='fill:rgb(255, 255, 255);stroke-width:0.1;stroke:rgb(0, 0, 0)' />\n      </svg>");return encodeURI("data:image/svg+xml;utf-8,"+u)}},{key:"componentDidMount",value:function(){this.tooltip=(0,n.Z)("#node-tooltip").style("opacity",0).style("background","lightsteelblue").style("position","absolute").style("width","auto").style("height","100px").style("overflow","auto").style("padding","5px").style("border","0px").style("border-radius","8px")}},{key:"componentDidUpdate",value:function(t,e,o){var n=this;if(c().use(l()),void 0!==this.props&&void 0!==this.props.nodes&&0!==this.props.nodes.length){if(t.nodes!==this.props.nodes&&t.dependencies!==this.props.dependencies){var r=[],s=[],i=[];i.push({selector:".linkType-1",style:{width:1,"target-arrow-shape":"triangle","curve-style":"bezier","line-style":"dashed"}}),i.push({selector:".linkType-0",style:{width:1,"target-arrow-shape":"triangle","curve-style":"bezier"}}),this.props.nodes.forEach((function(t){var e=n.props.nodesStatus[t.id];if(void 0===e){var o={data:{id:t.id},group:"nodes",grabbable:!1},s={selector:"#"+t.id,css:{"background-image":n.getProgressSVG("Calculation",1,0,n.state.subtaskWidth,n.state.subtaskHeight),"border-width":.3,"border-color":"black"}};r.push(o),i.push(s)}else{var a={data:{id:t.id},group:"nodes",grabbable:!1},c={selector:"#"+t.id,css:{"background-image":n.getProgressSVG(e.nodeType,e.progress,e.status,n.state.subtaskWidth,n.state.subtaskHeight),"border-width":.3,"border-color":"black"}};r.push(a),i.push(c)}})),this.props.dependencies.forEach((function(t){var e=1===t.linkType?"linkType-1":"linkType-0",o=n.props.nodesStatus[t.fromNodeId],r=n.props.nodesStatus[t.toNodeId],i={data:{source:t.fromNodeId,target:t.toNodeId,sourceNodeName:void 0===o?"":o.name,targetNodeName:void 0===r?"":r.name},group:"edges",classes:e};s.push(i)})),this.cy=window.cy=c()({container:document.getElementById(this.props.graphName),boxSelectionEnabled:!1,autounselectify:!0,layout:{name:"dagre"},style:i,elements:{nodes:r,edges:s}}),this.cy.on("mouseover","node",(function(t){var e=t.originalEvent.clientX,o=t.originalEvent.clientY,r=t.target[0]._private.data.id,s=t.target[0]._private.edges.map((function(t){var e=t._private.data;return e.fromNodeId===r?e.targetNodeName:e.sourceNodeName})),i=n.props.nodesStatus[r];if(void 0!==i){if("Calculation"!==i.nodeType){for(var a="",c="Output"===i.nodeType?"Source Nodes: ":"Target Nodes: ",u=0;u<s.length;u++)a+="<p>"+c+s[u]+"</p>";var l="\n              <div>\n                <p>Connected Nodes:</p>\n                ".concat(a,"\n              </div>\n              ");n.tooltip.html(l).style("left",e+"px").style("top",o+5+"px")}else{var d="\n              <div>\n                <p>Node Name:</p>\n                ".concat(n.props.nodesStatus[r].name,"\n              </div>\n              ");n.tooltip.html(d).style("left",e+"px").style("top",o+5+"px")}n.tooltip.transition().duration(200).style("opacity",.9)}})),this.cy.on("mouseout","node",(function(t){n.tooltip.transition().duration(200).style("opacity",0)}))}t.nodes===this.props.nodes&&t.dependencies===this.props.dependencies&&t.nodesStatus!==this.props.nodesStatus&&this.props.nodes.forEach((function(t){var e=n.props.nodesStatus[t.id];void 0!==e&&e.status>=0&&e.progress>=0&&n.cy.nodes('[id = "'.concat(t.id,'"]')).style("background-image",n.getProgressSVG(e.nodeType,e.progress,e.status,n.state.subtaskWidth,n.state.subtaskHeight)).style("border-width",.3).style("border-color","black")}))}}},{key:"render",value:function(){return i.createElement(i.Fragment,null,i.createElement("div",{id:this.props.graphName,style:this.props.dagStyle}),i.createElement("div",{id:"node-tooltip"}))}}])&&f(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),u}(i.Component);function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function k(t,e){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},k(t,e)}function w(t,e){if(e&&("object"===v(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function x(t){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},x(t)}g.propTypes={graphName:s().string.isRequired,dagStyle:d.D$,nodes:d.aY,nodeShape:s().string.isRequired,nodesStatus:d.nd,dependencies:d.ei,onNodeClick:s().func};var S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&k(t,e)}(c,t);var e,o,r,s,a=(r=c,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(r);if(s){var o=x(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return w(this,t)});function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(e=a.call(this,t)).state={subtasks:[],dependencies:[],subtaskDetails:{},subtaskStatus:[{text:"Input Node",color:"#3281A8",legendDotXLoc:"10",legendDotYLoc:"20",legendTextXLoc:"20",legendTextYLoc:"21"},{text:"Output Node",color:"#C334EB",legendDotXLoc:"135",legendDotYLoc:"20",legendTextXLoc:"145",legendTextYLoc:"21"}]},e}return e=c,(o=[{key:"generateGraphLegendItem",value:function(t,e,o,n,r,s,i){t.append("circle").attr("cx",e).attr("cy",o).attr("r",6).style("fill",s),t.append("text").attr("x",n).attr("y",r).text(i).style("font-size","15px").attr("alignment-baseline","middle")}},{key:"fetchGraphDetail",value:function(){var t=this,e=this.props,o=e.sessionId,n=e.taskId,r=e.tileableId;void 0!==o&&void 0!==n&&void 0!==r&&fetch("api/session/".concat(o,"/task/").concat(n,"/").concat(r,"/subtask?with_input_output=true")).then((function(t){return t.json()})).then((function(e){var o=[],n=[];Object.keys(e).length>0&&(o=Object.keys(e).map((function(t){return{id:t,name:e[t].name}})),Object.keys(e).filter((function(t){return e[t].fromSubtaskIds.length>0})).forEach((function(t){e[t].fromSubtaskIds.forEach((function(e){n.push({fromNodeId:e,toNodeId:t})}))}))),t.setState({subtasks:o,dependencies:n})}))}},{key:"fetchSubtaskDetail",value:function(){var t=this,e=this.props,o=e.sessionId,n=e.taskId,r=e.tileableId;void 0!==o&&void 0!==n&&void 0!==r&&fetch("api/session/".concat(o,"/task/").concat(n,"/").concat(r,"/subtask?with_input_output=true")).then((function(t){return t.json()})).then((function(e){t.setState({subtaskDetails:e})}))}},{key:"componentDidMount",value:function(){var t=this;void 0!==this.interval&&clearInterval(this.interval),this.interval=setInterval((function(){return t.fetchSubtaskDetail()}),1e3),this.fetchSubtaskDetail(),this.fetchGraphDetail();var e=(0,n.Z)("#subtasks-legend");this.state.subtaskStatus.forEach((function(o){return t.generateGraphLegendItem(e,o.legendDotXLoc,o.legendDotYLoc,o.legendTextXLoc,o.legendTextYLoc,o.color,o.text)}))}},{key:"componentDidUpdate",value:function(t,e,o){t.tileableId!==this.props.tileableId&&(this.fetchSubtaskDetail(),this.fetchGraphDetail())}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){return void 0===this.state||void 0===this.state.subtasks||void 0===this.state.dependencies||void 0===this.state.subtaskDetails?i.createElement("div",null,"Loading"):i.createElement(i.Fragment,null,i.createElement("h2",null,"Subtask Graph Info:"),this.state.subtasks.length+this.state.dependencies.length>2e3&&i.createElement("div",null,"Warning: this subtask graph contains a lot of elements and may take some time to load"),i.createElement("svg",{id:"subtasks-legend",style:{marginLeft:"6%",width:"90%",height:50}}),i.createElement(g,{graphName:"subtaskGraph",dagStyle:{margin:15,width:"90%",height:"80%",minHeight:200},nodes:this.state.subtasks,nodeShape:"circle",nodesStatus:this.state.subtaskDetails,dependencies:this.state.dependencies}))}}])&&m(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),c}(i.Component);S.propTypes={sessionId:s().string.isRequired,taskId:s().string.isRequired,tileableId:s().string.isRequired}}}]);