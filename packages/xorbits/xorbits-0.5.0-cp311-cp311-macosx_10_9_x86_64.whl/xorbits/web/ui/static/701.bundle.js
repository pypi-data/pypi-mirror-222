"use strict";(self.webpackChunkxorbits_ui=self.webpackChunkxorbits_ui||[]).push([[701],{1701:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var r=n(4373),o=n(30),i=n(3896),a=n(5697),s=n.n(a),l=n(7294),c=n(6550),p=n(5713),u=n(3838),f=n(4949),d=n(3471),h=n(816);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function g(e,t){if(t&&("object"===y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(r);if(o){var n=v(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={nodeStatusMap:[{text:"Pending",color:"#FFFFFF"},{text:"Running",color:"#F4B400"},{text:"Succeeded",color:"#00CD95"},{text:"Failed",color:"#E74C3C"},{text:"Cancelled",color:"#BFC9CA"}],inputNodeColor:"#3281a8",outputNodeColor:"#c334eb"},t.lastSelectedId=null,t}return t=a,(n=[{key:"componentDidMount",value:function(){this.g=(new f.graphlib.Graph).setGraph({})}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"getNodeStyle",value:function(e){return e!==this.lastSelectedId?"cursor: pointer; stroke: #333; fill: url(#progress-"+e+")":"cursor: pointer; stroke: #ff5252; stroke-width: 3; fill: url(#progress-"+e+")"}},{key:"componentDidUpdate",value:function(e,t,n){var r=this;if(void 0!==this.props&&void 0!==this.props.nodes&&0!==this.props.nodes.length){if(e.nodes!==this.props.nodes&&e.dependencies!==this.props.dependencies){(0,u.Z)("#"+this.props.graphName).selectAll("*").remove();var o=(0,u.Z)("#"+this.props.graphName),i=o.append("g");this.g=(new f.graphlib.Graph).setGraph({}),this.props.nodes.forEach((function(e){var t=r.props.nodesStatus[e.id],n={node:e};if("tileableGraph"===r.props.graphName){var o=e.name.indexOf("key")-1;n.label=e.name.substring(0,o)}else"subtaskGraph"===r.props.graphName&&(n.label="");"tileableGraph"===r.props.graphName?n.rx=n.ry=5:"subtaskGraph"===r.props.graphName&&(n.r=20),r.g.setNode(e.id,n);var a=i.append("linearGradient").attr("id","progress-"+e.id),s=r.g.node(e.id);void 0===t?a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color","#FFFFFF").attr("offset",1):-1===t.status&&-1===t.progress?a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color",r.state.inputNodeColor).attr("offset",1):-2===t.status&&-2===t.progress?a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color",r.state.outputNodeColor).attr("offset",1):a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color",r.state.nodeStatusMap[t.status].color).attr("offset",t.progress),a.append("stop").attr("stop-color","#FFFFFF").attr("offset","0"),s.shape=r.props.nodeShape,s.style=r.getNodeStyle(e.id),s.labelStyle="cursor: pointer"})),this.props.dependencies.forEach((function(e){e.linkType&&1===e.linkType?r.g.setEdge(e.fromNodeId,e.toNodeId,{style:"stroke: #333; fill: none; stroke-dasharray: 5, 5;"}):r.g.setEdge(e.fromNodeId,e.toNodeId,{style:"stroke: #333; fill: none;"})}));var a=this.g;a.nodes().forEach((function(e){var t=a.node(e);t.rx=t.ry=5}));var s=new f.render;0!==this.props.nodes.length&&s(i,this.g),i.selectAll("g.node").on("click",(function(e,t){if(r.props.onNodeClick){var n=r.props.nodes.filter((function(e){return e.id===t}))[0],o=r.props.nodesStatus[n.id];if(n.properties=o.properties,t!==r.lastSelectedId){var a=r.lastSelectedId;r.lastSelectedId=t,null!==a&&(r.g.node(a).style=r.getNodeStyle(a)),r.g.node(t).style=r.getNodeStyle(t),s(i,r.g)}r.props.onNodeClick(e,n)}}));var l=i.node().getBBox(),c=i.node().parentElement,p=l.width,h=l.height,y=c.clientWidth,b=c.clientHeight,m=b>=h?1:b/h;(0,u.Z)("#"+this.props.graphName).select(".output").attr("transform","translate("+(y-p*m)/2+", "+(b-h*m)/2+")");var g=(0,d.sP)().on("zoom",(function(e){i.attr("transform",e.transform)}));o.call(g,g.transform,d.CR.scale(m)),null!==this.g.graph()||void 0!==this.g.graph()?o.attr("height",this.g.graph().height*m+40):o.attr("height",40)}if(e.nodes===this.props.nodes&&e.dependencies===this.props.dependencies&&e.nodesStatus!==this.props.nodesStatus){var v=(0,u.Z)("#"+this.props.graphName);this.props.nodes.forEach((function(e){var t=r.props.nodesStatus[e.id];if(void 0!==t&&t.status>=0&&t.progress>=0){var n=r.g.node(e.id);void 0!==n&&("visibility: hidden"===n.style&&(n.shape=r.props.nodeShape,n.style="cursor: pointer; stroke: #333; fill: url(#progress-"+e.id+")",n.labelStyle="cursor: pointer"),v.select("#progress-"+e.id+"-stop").attr("stop-color",r.state.nodeStatusMap[t.status].color).attr("offset",t.progress))}}))}}}},{key:"render",value:function(){return l.createElement("svg",{id:this.props.graphName,style:this.props.dagStyle})}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(l.Component);function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},S(e,t)}function w(e,t){if(t&&("object"===O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}E.propTypes={graphName:s().string.isRequired,dagStyle:h.D$,nodes:h.aY,nodeShape:s().string.isRequired,nodesStatus:h.nd,dependencies:h.ei,onNodeClick:s().func};var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(r);if(o){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return w(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={selectedTileable:null,tileables:[],dependencies:[],tileableDetails:{},tileableStatus:[{text:"Pending",color:"#FFFFFF",legendDotXLoc:"430",legendDotYLoc:"20",legendTextXLoc:"440",legendTextYLoc:"21"},{text:"Running",color:"#F4B400",legendDotXLoc:"10",legendDotYLoc:"20",legendTextXLoc:"20",legendTextYLoc:"21"},{text:"Succeeded",color:"#00CD95",legendDotXLoc:"105",legendDotYLoc:"20",legendTextXLoc:"115",legendTextYLoc:"21"},{text:"Failed",color:"#E74C3C",legendDotXLoc:"345",legendDotYLoc:"20",legendTextXLoc:"355",legendTextYLoc:"21"},{text:"Cancelled",color:"#BFC9CA",legendDotXLoc:"225",legendDotYLoc:"20",legendTextXLoc:"235",legendTextYLoc:"21"}]},t}return t=a,(n=[{key:"generateGraphLegendItem",value:function(e,t,n,r,o,i,a){"#FFFFFF"===i?e.append("circle").attr("cx",t).attr("cy",n).attr("r",6).attr("stroke","#333").style("fill",i):e.append("circle").attr("cx",t).attr("cy",n).attr("r",6).style("fill",i),e.append("text").attr("x",r).attr("y",o).text(a).style("font-size","15px").attr("alignment-baseline","middle")}},{key:"fetchGraphDetail",value:function(){var e=this,t=this.props,n=t.sessionId,r=t.taskId;fetch("api/session/".concat(n,"/task/").concat(r,"/tileable_graph?action=get_tileable_graph_as_json")).then((function(e){return e.json()})).then((function(t){e.setState({tileables:t.tileables.map((function(e){return{id:e.tileableId,name:e.tileableName}})),dependencies:t.dependencies.map((function(e){return{fromNodeId:e.fromTileableId,toNodeId:e.toTileableId}}))})}))}},{key:"fetchTileableDetail",value:function(){var e=this,t=this.props,n=t.sessionId,r=t.taskId;fetch("api/session/".concat(n,"/task/").concat(r,"/tileable_detail")).then((function(e){return e.json()})).then((function(t){e.setState({tileableDetails:t})}))}},{key:"componentDidMount",value:function(){var e=this;this.g=(new f.graphlib.Graph).setGraph({}),void 0!==this.interval&&clearInterval(this.interval),this.interval=setInterval((function(){return e.fetchTileableDetail()}),1e3),this.fetchTileableDetail(),this.fetchGraphDetail();var t=(0,u.Z)("#tileables-legend");this.state.tileableStatus.forEach((function(n){return e.generateGraphLegendItem(t,n.legendDotXLoc,n.legendDotYLoc,n.legendTextXLoc,n.legendTextYLoc,n.color,n.text)}))}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){return void 0===this.state||void 0===this.state.tileables||void 0===this.state.dependencies||void 0===this.state.tileableDetails?l.createElement("div",null,"Loading"):l.createElement(l.Fragment,null,l.createElement("svg",{id:"tileables-legend",style:{marginLeft:"6%",width:"90%",height:"10%"}}),l.createElement(E,{graphName:"tileableGraph",dagStyle:{margin:30,width:"90%",height:"80%"},nodes:this.state.tileables,nodeShape:"rect",nodesStatus:this.state.tileableDetails,dependencies:this.state.dependencies,onNodeClick:this.props.onTileableClick}))}}])&&k(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(l.Component);x.propTypes={sessionId:s().string.isRequired,taskId:s().string.isRequired,onTileableClick:s().func};var j=n(214),P=n(3150),_=n(6140),I=n(7272),D=n(8736),R=n(5293);function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}function L(e,t){if(t&&("object"===C(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Z(e)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}var B=(0,l.lazy)((function(){return Promise.all([n.e(601),n.e(615)]).then(n.bind(n,2615))})),Y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=G(r);if(o){var n=G(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return L(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={displayedTileableDetail:0},t.handleDetailTabChange=t.handleDetailTabChange.bind(Z(t)),t}return t=a,(n=[{key:"handleDetailTabChange",value:function(e,t){this.setState({displayedTileableDetail:t})}},{key:"render",value:function(){var e=this;return void 0===this.props?null:this.props.tileable?l.createElement(l.Fragment,null,l.createElement(R.Z,{value:this.state.displayedTileableDetail,onChange:this.handleDetailTabChange},l.createElement(j.Z,{label:"Tileable Info"}),l.createElement(j.Z,{label:"Subtask Info"})),l.createElement("br",null),l.createElement("div",null,0===this.state.displayedTileableDetail?l.createElement(l.Fragment,null,l.createElement(P.Z,{size:"small",style:{height:"100%"}},l.createElement(_.Z,null,l.createElement(D.Z,null,l.createElement(I.Z,{variant:"head"},l.createElement("b",null,"Tileable ID")),l.createElement(I.Z,null,this.props.tileable.id)),l.createElement(D.Z,null,l.createElement(I.Z,{variant:"head"},l.createElement("b",null,"Tileable Name")),l.createElement(I.Z,null,this.props.tileable.name)),Object.keys(this.props.tileable.properties).map((function(t){return l.createElement(D.Z,{key:t},l.createElement(I.Z,{variant:"head"},l.createElement("b",null,t)),l.createElement(I.Z,null,e.props.tileable.properties[t]))}))))):l.createElement(l.Suspense,{fallback:l.createElement("div",null,"Loading...")},l.createElement(B,{sessionId:this.props.sessionId,taskId:this.props.taskId,id:this.props.tileable.id})))):l.createElement(l.Fragment,null,"Select a tileable to view its detail")}}])&&F(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(l.Component);Y.propTypes={tileable:s().shape({id:s().string,name:s().string,properties:s().shape({id:s().string})}),sessionId:s().string.isRequired,taskId:s().string.isRequired};const q=Y;function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t){return z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},z(e,t)}function A(e,t){if(t&&("object"===X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function U(e){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},U(e)}var W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&z(e,t)}(u,e);var t,n,a,s,c=(a=u,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=U(a);if(s){var n=U(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return A(this,e)});function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=c.call(this,e)).state={selectedTileable:null},t}return t=u,(n=[{key:"render",value:function(){var e=this;return void 0===this.props?null:l.createElement(o.ZP,{container:!0,spacing:3},l.createElement(o.ZP,{item:!0,xs:12},l.createElement(p.Z,null,"Task ",this.props.match.params.task_id)),l.createElement(o.ZP,{item:!0,xs:12},l.createElement(i.Z,null,l.createElement(o.ZP,{container:!0,spacing:3},l.createElement(o.ZP,{item:!0,xs:12,sm:6},l.createElement(x,{sessionId:this.props.match.params.session_id,taskId:this.props.match.params.task_id,onTileableClick:function(t,n){e.setState({selectedTileable:n})}})),l.createElement(r.Z,{orientation:"vertical",flexItem:!0,style:{marginRight:"-1px"}}),l.createElement(o.ZP,{item:!0,xs:12,sm:6},l.createElement(o.ZP,{item:!0,xs:12},l.createElement(q,{tileable:this.state.selectedTileable,sessionId:this.props.match.params.session_id,taskId:this.props.match.params.task_id})))))))}}])&&M(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(l.Component);W.propTypes={match:s().shape({params:s().shape({session_id:s().string.isRequired,task_id:s().string.isRequired})})};const $=(0,c.EN)(W)},816:(e,t,n)=>{n.d(t,{D$:()=>l,aY:()=>i,ei:()=>s,nd:()=>a});var r=n(5697),o=n.n(r),i=o().arrayOf(o().shape({id:o().string.isRequired,name:o().string})),a=o().shape({id:o().shape({status:o().number.isRequired,progress:o().number.isRequired,subtaskCount:o().number,properties:o().shape({id:o().string})})}),s=o().arrayOf(o().shape({fromNodeId:o().string.isRequired,toNodeId:o().string.isRequired,linkType:o().number})),l=o().shape({margin:o().oneOfType([o().number,o().string]),padding:o().oneOfType([o().number,o().string]),width:o().oneOfType([o().number,o().string]),height:o().oneOfType([o().number,o().string])})}}]);