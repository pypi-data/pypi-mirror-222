Metadata-Version: 2.1
Name: hamqtt-fs-publisher
Version: 0.1.3
Summary: Publish file content as MQTT topic compatible with HomeAssistant.
Home-page: https://github.com/MarekPikula/homeassistant-mqtt-filesystem-publisher
License: MIT
Author: Marek Pikuła
Author-email: marek@serenitycode.dev
Maintainer: Marek Pikuła
Maintainer-email: marek@serenitycode.dev
Requires-Python: >=3.8,<4.0
Classifier: Development Status :: 3 - Alpha
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Provides-Extra: pyyaml
Provides-Extra: ruamel
Requires-Dist: click (>=8.1.3,<9.0.0)
Requires-Dist: homeassistant-mqtt-binding (>=2.0.2,<3.0.0)
Requires-Dist: loguru (>=0.7.0,<0.8.0)
Requires-Dist: pydantic (>=1.10.7,<2.0.0)
Requires-Dist: pydantic-yaml (>=0.11.2,<0.12.0) ; extra == "ruamel" or extra == "pyyaml"
Requires-Dist: pyyaml (>=6.0,<7.0) ; extra == "pyyaml"
Requires-Dist: ruamel-yaml (>=0.17.24,<0.18.0) ; extra == "ruamel"
Project-URL: Repository, https://github.com/MarekPikula/homeassistant-mqtt-filesystem-publisher
Description-Content-Type: text/markdown

[![build](https://github.com/MarekPikula/homeassistant-mqtt-filesystem-publisher/workflows/build/badge.svg)](https://github.com/MarekPikula/homeassistant-mqtt-filesystem-publisher/actions?query=workflow%3Abuild+branch%3Amain)
[![PyPI - Python Version](https://img.shields.io/pypi/pyversions/hamqtt-fs_publisher.svg)](https://pypi.org/project/hamqtt-fs_publisher)

# HomeAssistant MQTT filesystem publisher

Publish file content as an MQTT topic compatible with HomeAssistant.

It can be useful, e.g., to publish system metrics from `/sys`.

## Quick start

1. Install the Python package: `pip install hamqtt-fs-publisher`. If you want to
   have support for YAML configuration format install with `ruamel` or `pyyaml`
   extras depending on the YAML library of choice (recommended `ruamel`, e.g.,
   `pip install hamqtt-fs-publisher[ruamel]`).
2. Create a configuration (example in `examples/config.example.yaml`). It can be
   in either YAML or JSON format. There is a pre-generated JSON schema in
   `hamqtt_fs_publisher/configuration.schema.json`, which can be used, e.g.,
   with VS Code (the current repository is pre-configured for `config.json` and
   `config.yaml`). Remember to set proper authorization details for the MQTT
   broker. If you are using the standard Mosquitto broker add-on in Home
   Assistant, please refer to the [official
   documentation](https://github.com/home-assistant/addons/blob/master/mosquitto/DOCS.md).
3. Run `hamqtt_fs_publisher --config <config_file_name>`.

> **Note:** The configuration file path could be either a relative/absolute
> path, or a file under `/etc/hamqtt_fs_publisher` or
> `~/.config/hamqtt_fs_publisher`.

## Systemd service

If you want to run this script as a systemd service you could copy the example
service file from `examples/hamqtt_fs_publisher@.service` to either
`/etc/systemd/system/` or `~/.config/systemd/user/` (if you want to run it in
user mode). Then copy the configuration file to one of the standard
configuration directories (i.e., `/etc/hamqtt_fs_publisher` or
`~/.config/hamqtt_fs_publisher`.)

To enable and start the unit in system mode run:

```shell
$ systemd daemon-reload
$ systemd enable --now hamqtt_fs_publisher@<config_file_name>
```

## Supported features

- Auto-discovery in HomeAssistant.
- Configuration with a simple YAML/JSON file.
- Possibility to create read-only sensor device entities with values taken
  from a file and published to the MQTT broker periodically with set intervals.

## TODO

- Add a logger to connect/disconnect events.
- Add an option to read a value on a button push in GUI (not only periodically).
- Add a switch endpoint (i.e., a file writer).
- Add a generic writer endpoint.

