"use strict";(self.webpackChunk_tiledb_inc_tiledb_plot_widget=self.webpackChunk_tiledb_inc_tiledb_plot_widget||[]).push([[568],{501:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t,i)=>Math.max(e,Math.min(i,t))},268:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{let i;return(...l)=>new Promise((s=>{i&&clearTimeout(i),i=setTimeout((()=>s(e(...l))),t)}))}},568:function(e,t,i){var l=this&&this.__createBinding||(Object.create?function(e,t,i,l){void 0===l&&(l=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,l,s)}:function(e,t,i,l){void 0===l&&(l=i),e[l]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||l(t,e,i)},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&l(t,e,i);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const a=i(395);n(i(657),t);const r=o(i(367)),u=i(657),d={id:"@tiledb-inc/tiledb-plot-widget:plugin",requires:[a.IJupyterWidgetRegistry],autoStart:!0,activate:(e,t)=>{t.registerWidget({name:u.MODULE_NAME,version:u.MODULE_VERSION,exports:r})}};t.default=d},879:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.poll=void 0,t.poll=function(e,t=2e3,i=100){const l=Number(new Date)+t,s=function(t,n){const o=e();o?t(o):Number(new Date)<l?setTimeout(s,i,t,n):n(new Error("timed out for "+e+": "))};return new Promise(s)}},657:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_NAME=t.MODULE_VERSION=void 0;const l=i(147);t.MODULE_VERSION=l.version,t.MODULE_NAME=l.name},367:function(e,t,i){var l=this&&this.__createBinding||(Object.create?function(e,t,i,l){void 0===l&&(l=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,l,s)}:function(e,t,i,l){void 0===l&&(l=i),e[l]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&l(t,e,i);return s(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DagVisualizeView=t.DagVisualizeModel=void 0;const a=i(395),r=n(i(289)),u=o(i(268)),d=i(657),c=i(879),p=o(i(501));class b extends a.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:b.model_name,_model_module:b.model_module,_model_module_version:b.model_module_version,_view_name:b.view_name,_view_module:b.view_module,_view_module_version:b.view_module_version,value:""})}}t.DagVisualizeModel=b,b.serializers=Object.assign({},a.DOMWidgetModel.serializers),b.model_name="DagVisualizeModel",b.model_module=d.MODULE_NAME,b.model_module_version=d.MODULE_VERSION,b.view_name="DagVisualizeView",b.view_module=d.MODULE_NAME,b.view_module_version=d.MODULE_VERSION;class m extends a.DOMWidgetView{render(){this.el.classList.add("tiledb-widget"),this.createSVG(),this.value_changed();const e=(0,u.default)(this.value_changed.bind(this),1500);this.model.on("change:value",e,this)}value_changed(){this.data=JSON.parse(this.model.get("value")),this.createDag()}calculateBounds(e){if(void 0===this.bounds){const t=Object.values(e).map((e=>e[0])),i=Object.values(e).map((e=>e[1])),l=30,s=60,n=Math.max(...t),o=Math.max(...i);this.bounds=[n+l,o+s]}return this.bounds}createSVG(){this.wrapper=r.select(this.el).append("svg").append("g"),this.svg=r.select(this.el).select("svg"),this.createControls(),this.createTooltip()}zoom(e,t){const i=this.svg,l=r.zoom().translateExtent([[0,0],[e,t]]).on("zoom",(e=>{this.wrapper.attr("transform",e.transform)}));function s(){const e="zoom_in"===this.id?.2:-.2;i.transition().duration(300).call(l.scaleBy,1+e)}function n(){i.transition().duration(300).call(l.transform,r.zoomIdentity)}i.call(l).on("wheel.zoom",null),setTimeout((()=>{r.select(this.el).selectAll(".zoomControl").on("click",s),r.select(this.el).selectAll(".resetControl").on("click",n)}),0),this.initialized=!0}createTooltip(){this.tooltip=r.select(this.el).append("div").attr("class","tooltip").style("opacity",0)}getRootNodes(e,t){return e.filter((e=>t.every((([,t])=>e!==t))))}getNodeSize(e){return 15*e*.8}getHeightScale(e,t){const i=.7*t,l=.3*t,s=(0,p.default)(l,i,e);return[s,s/e]}async createDag(){const{nodes:e,edges:t,node_details:i,positions:l}=this.data,[s,n]=this.calculateBounds(l),[o,a]=this.getHeightScale(n,s),u=r.select(this.el).select("svg"),d=this.getNodeSize(a),b=s+d,m=(0,p.default)(225,b,b),f=(m-b)/2,_=e.length,g=m>5e3;u.attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${m} ${o}`),g&&u.attr("class","tiledb-plot--bolder"),f&&this.svg.select("g").attr("transform",`translate(${f})`),this.initialized||await(0,c.poll)((()=>this.el.offsetWidth>0),300);const v=_<30?"node--small":"";this.positions=this.positions||l,this.initialized||this.zoom(s,o);const y=Object.fromEntries(Object.entries(i).map((([e,t],i)=>{const l=this.positions[e],[s,o]=l,r=s+d/2,u=(n-o)*a;return[e,{index:i,name:t.name,status:t.status,id:e,x:r,y:u}]}))),j=Object.values(y),w=t.map((([e,t])=>({parent:y[e],child:y[t]})));this.wrapper.selectAll("path").data(w).join((e=>{e.append("path").attr("d",(e=>`M${e.parent.x},${e.parent.y} C ${e.parent.x},${(e.parent.y+e.child.y)/2} ${e.child.x},${(e.parent.y+e.child.y)/2} ${e.child.x},${e.child.y}`)).attr("class",(e=>`path-${h(e.child.status)}`))}),(e=>e.attr("class",(e=>`path-${h(e.child.status)}`)))),this.wrapper.selectAll("circle").data(j).join((e=>{e.append("circle").attr("cx",(e=>e.x)).attr("cy",(e=>e.y)).attr("r",d).attr("class",(e=>`${h(e.status)} ${v}`)).on("mouseover",((e,t)=>{const i=t.name||t.id;this.tooltip.transition().duration(200).style("opacity",.9),this.tooltip.html(`<p class="tiledb-plot-tooltip">${i}: <b>${t.status}</b></p>`).style("left",`${e.offsetX+10}px`).style("top",`${e.offsetY+10}px`)})).on("mouseout",(()=>{this.tooltip.transition().duration(500).style("opacity",0)}))}),(e=>{e.attr("class",(e=>`${h(e.status)} ${v}`))}),(e=>{e.on("mouseover",null).on("mouseout",null).remove()}))}createControls(){const e=document.createElement("button"),t=document.createElement("button"),i=document.createElement("button"),l="zoomControl";e.id="zoom_in",t.id="zoom_out",i.className="resetControl",e.className=l,t.className=l,this.el.append(e),this.el.append(t),this.el.append(i)}}function h(e){return e.toLowerCase().replace(/[ _]/g,"-")}t.DagVisualizeView=m},147:e=>{e.exports=JSON.parse('{"name":"@tiledb-inc/tiledb-plot-widget","version":"1.1.0","description":"Custom Jupyterlab widget for TileDB","keywords":["jupyter","jupyterlab","jupyterlab-extension"],"homepage":"https://github.com/TileDB-Inc/TileDB-Jupyter-Plot-Widget","bugs":{"url":"https://github.com/TileDB-Inc/TileDB-Jupyter-Plot-Widget/issues"},"license":"MIT","author":{"name":"TileDB","email":"hello@tiledb.com"},"files":["lib/**/*.{d.ts,eot,gif,html,jpg,js,js.map,json,png,svg,woff2,ttf}","dist/*.js","style/**/*.{css,js,eot,gif,html,jpg,json,png,svg,woff2,ttf}","icons/*.svg"],"main":"lib/index.js","types":"lib/index.d.ts","style":"style/index.css","repository":{"type":"git","url":"https://github.com/TileDB-Inc/TileDB-Jupyter-Plot-Widget.git"},"scripts":{"build":"jlpm run build:lib && jlpm run build:labextension:dev","build:prod":"jlpm run clean && jlpm run build:lib && jlpm run build:labextension && jlpm run build:webpack","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:webpack":"webpack --mode=production","build:lib":"tsc","clean":"jlpm run clean:lib","clean:lib":"rimraf lib tsconfig.tsbuildinfo","clean:labextension":"rimraf tiledb/plot/widget/labextension","clean:all":"jlpm run clean:lib && jlpm run clean:labextension","eslint":"eslint . --ext .ts,.tsx --fix","eslint:check":"eslint . --ext .ts,.tsx","install:extension":"jlpm run build","watch":"run-p watch:src watch:labextension","watch:src":"tsc -w","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^2 || ^3 || ^4 || ^5 || ^6","@jupyterlab/application":"^3 || ^4.0.2","d3":"^7.8.5"},"devDependencies":{"@jupyterlab/builder":"^3 || ^4.0.2","@types/d3":"^7.1.0","@types/webpack-env":"^1.16.3","@typescript-eslint/eslint-plugin":"^4.8.1","@typescript-eslint/parser":"^4.8.1","eslint":"^7.14.0","eslint-config-prettier":"^6.15.0","eslint-plugin-prettier":"^3.1.4","git-tag-version":"^1.3.1","npm-run-all":"^4.1.5","prettier":"^2.1.1","rimraf":"^3.0.2","source-map-loader":"^3.0.0","style-loader":"^3.3.1","ts-loader":"9","typescript":"~5.1.6","webpack":"^5.88.1","webpack-cli":"^5.1.4"},"sideEffects":["style/*.css","style/index.js"],"styleModule":"style/index.js","publishConfig":{"access":"public"},"jupyterlab":{"extension":true,"outputDir":"tiledb/plot/widget/labextension","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}},"discovery":{"server":{"managers":["pip"],"base":{"name":"tiledb-plot-widget"}}}},"jupyter-releaser":{"hooks":{"before-build-npm":["python -m pip install jupyterlab~=3.1","jlpm"]}}}')}}]);