<!DOCTYPE html>
<html lang="en">
<head>
  <title>{{title}}</title>
  <style>
    #headerGrid {
      display: grid;
      grid-template-columns: 25% 50% 25%;
    }
    #headerCenter {
      text-align: center;
    }
  </style>
  <div id="headerGrid">
    <div id="headerLeft">
       <a href="/">home</a>
    </div>
    <div id="headerCenter">
      <h2>{{name}}</h2>
    </div>
    <div id="headerRight">
    </div>
  </div>
</head>
<body>
  <style>
    #content {
      text-align: center;
    }
  </style>
  <script>
    /**
     * Read a value from OD.
     *
     * @param {String} index The index of the object to write to.
     * @param {String} subindex The eubndex of the object to write to. Set to
     * null if subindex is not needed. 
     *
     * @return {Object} The object from the OD.
     */
    async function readValue(index, subindex) {
      let url = `http://${window.location.host}/od/${index}`;
      if (subindex !== null && subindex !== "") {
        url = `http://${window.location.host}/od/${index}/${subindex}`;
      }

      return await fetch(url)
        .then(response => response.json())
        .then(data => {
          if (data.error !== undefined) {
            console.log(data);
          }
          return data;
        });
    }

    /**
     * Write a value to OD.
     *
     * @param {String} index The index of the object to write to.
     * @param {String} subindex The eubndex of the object to write to. Set to
     * an emoty sring or null if subindex is not needed. 
     * @param {Any} value The value to write to OD.
     *
     * @return {Object} The object after the new value was written to it.
     */
    async function writeValue(index, subindex, value) {
      let options = {
        "method": "PUT",
        headers: {
          "Content-Type": "application/json",
        },
        "body": JSON.stringify({
          "value": value,
        }),
      };
      
      let url = `http://${window.location.host}/od/${index}`;
      if (subindex !== null && subindex !== "") {
        url = `http://${window.location.host}/od/${index}/${subindex}`;
      }

      return await fetch(url, options)
        .then(response => response.json())
        .then(data => {
          if (data.error !== undefined) {
            console.log(data);
          }
          return data;
        });
    }

    /**
     * Convert a SCET value to a data object.
     *
     * @param {Number} scet The SCET value.
     *
     * @return {Date} The date object.
     */
    function scetToDate(scet) {
      // convert to binary
      let base2 = scet.toString(2);
      const leadingZeros = "0".repeat(64 - base2.length);
      base2 = leadingZeros + base2;

      const coarseStr = base2.substring(32);
      const fineStr = base2.substring(8, 32);

      const coarse = parseInt(coarseStr, 2);
      const fine = parseInt(fineStr, 2);

      // make unix time in ms
      const time = coarse * 1000 + fine / 1000;

      return new Date(time);
    }
  </script>
  <div id="content">
    {% block content %}{% endblock %}
  </div>
</body>
</html>
